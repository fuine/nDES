import torch
from gpu_utils import bounce_back_boundary_2d

if __name__ == "__main__":
    device = torch.device("cuda:0")
    a = torch.tensor(
        [
            [-1386.0077, 3332.5007, 1055.5032, -565.2601],
            [1038.6169, -1425.2521, -847.1431, 628.4320],
            [-108.6701, 1107.3376, 1553.3640, -536.9139],
            [-187.0682, 1417.4506, 77.6953, -1234.0394],
            [401.2337, 141.4529, 563.3681, 1164.2892],
            [1775.2698, 1104.7098, -551.6083, 1209.7771],
            [961.3401, 186.5654, -450.5545, 155.7374],
        ],
        device=device,
    )
    lower = -300
    upper = 500
    a = bounce_back_boundary_2d(a, lower, upper, upper - lower)
    result = torch.tensor(
        [
            [-13.9923, 67.4993, -55.5032, -34.7399],
            [-38.6169, 25.2521, 247.1431, 371.5680],
            [-108.6701, -107.3376, 246.6360, -63.0861],
            [-187.0682, 382.5494, 77.6953, -165.9606],
            [401.2337, 141.4529, 436.6319, -164.2892],
            [24.7302, -104.7098, -48.3917, -209.7771],
            [38.6599, 186.5654, -149.4455, 155.7374],
        ],
        device=device,
    )
    assert torch.allclose(a, result)
